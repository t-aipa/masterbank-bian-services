version: 1.0
components:
  - name: products-service
    source:
      language: bal
      path: products_service.bal
    build:
      target: bal
    deploy:
      type: api
      spec:
        openapi: 3.0.0
        info:
          title: Products API
          version: 1.0.0
      security:
        - oauth2:
            scopes: ["products.read", "products.write"]
    observability:
      metrics: true
      tracing: true
      logging: true

  - name: user-profile-service
    source:
      language: bal
      path: user_profile_service.bal
    build:
      target: bal
    deploy:
      type: api
      spec:
        openapi: 3.0.0
        info:
          title: User Profile API
          version: 1.0.0
      security:
        - oauth2:
            scopes: ["users.read", "users.write"]
    observability:
      metrics: true
      tracing: true
      logging: true

  - name: transaction-service
    source:
      language: bal
      path: transaction_service.bal
    build:
      target: bal
    deploy:
      type: api
      spec:
        openapi: 3.0.0
        info:
          title: Transaction API
          version: 1.0.0
      security:
        - oauth2:
            scopes: ["transactions.read", "transactions.write"]
    observability:
      metrics: true
      tracing: true
      logging: true

environment:
  - name: dev
    variables:
      - name: servicePath
        value: products
      - name: servicePort
        value: "8080"
  - name: prod
    variables:
      - name: servicePath
        value: products
      - name: servicePort
        value: "8080"

security:
  authentication:
    type: oauth2
    config:
      issuer: https://sts.choreo.dev
      audience: masterbank-bian-services
